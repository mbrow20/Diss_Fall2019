USACAN<-read.csv("USACAN_FullModel.csv",header=T, sep=",")
USACAN$ST011Q06TA[USACAN$ST011Q06TA>=3]=NA
USACAN$ST011Q07TA[USACAN$ST011Q07TA>=3]=NA
USACAN$ST013Q01TA[USACAN$ST013Q01TA>=7]=NA
USACAN$HISCED[USACAN$HISCED>=7]=NA
USACAN$MISCED[USACAN$MISCED>=7]=NA
USACAN$HOMEPOS[USACAN$HOMEPOS<=-10|USACAN$HOMEPOS>=7]=NA
USACAN$SC048Q01NA[USACAN$SC048Q01NA>=101]=NA
USACAN$SC048Q02NA[USACAN$SC048Q02NA>=101]=NA
USACAN$SC048Q03NA[USACAN$SC048Q03NA>=101]=NA
USACAN$CLSIZE[USACAN$CLSIZE>=85]=NA
USACAN$SC014Q01NA[USACAN$SC014Q01NA>3]=NA
USACAN$SC013Q01TA[USACAN$SC014Q01TA>2]=NA
USACAN$BELONG[USACAN$BELONG <= -4 | USACAN$BELONG >= 3 ]=NA
USACAN$ESCS[USACAN$ESCS <= -8 | USACAN$ESCS >= 5 ]=NA
USACAN$MMINS[USACAN$MMINS>= 3000]=NA
USACAN$SC061Q07TA[USACAN$SC061Q07TA > 4]=NA
colnames(USACAN)[1]="CNTRYID"
CAN2015_FULLMODEL<-subset(USACAN,USACAN$CNTRYID=="124")
USA2015_FULLMODEL<-subset(USACAN, USACAN$CNTRYID=="840")
#######################PS MODEL###################################
CAN2015_PSMODEL<-CAN2015_FULLMODEL
CAN2015_PSMODEL$treat<-ifelse(CAN2015_FULLMODEL$SC013Q01TA=="2",1,0)
USA2015_PSMODEL<-USA2015_FULLMODEL
USA2015_PSMODEL$treat<-ifelse(USA2015_FULLMODEL$SC013Q01TA=="2",1,0)
##################################################################
##Remove missing values from 'public/private'
CAN2015_PSMODEL<-CAN2015_PSMODEL[complete.cases(CAN2015_PSMODEL[ , 107]),]
USA2015_PSMODEL<-USA2015_PSMODEL[complete.cases(USA2015_PSMODEL[ , 107]),]
CAN2015_PSMODEL$Y<-CAN2015_PSMODEL$PV1MATH
USA2015_PSMODEL$Y<-USA2015_PSMODEL$PV1MATH
CAN2015_PSMODEL<-CAN2015_PSMODEL[,c(5:15,109:115,3,4)]
USA2015_PSMODEL<-USA2015_PSMODEL[,c(5:15,109:115,3,4)]
CAN2015_PSMODEL$SCHID<-CAN2015_PSMODEL$CNTSCHID
USA2015_PSMODEL$SCHID<-USA2015_PSMODEL$CNTSCHID
CAN2015_PSMODEL<-CAN2015_PSMODEL[,-19]
USA2015_PSMODEL<-USA2015_PSMODEL[,-19]
indxNumCAN<-dim(CAN2015_PSMODEL)[2]
indxNum2CAN<-indxNumCAN-3
varNamesCAN<-colnames(CAN2015_PSMODEL[,c(1:indxNum2CAN)])
indxNumUSA<-dim(USA2015_PSMODEL)[2]
indxNum2USA<-indxNumUSA-3
varNamesUSA<-colnames(USA2015_PSMODEL[,c(1:indxNum2USA)])
V1<-matrix(1,nrow(CAN2015_PSMODEL),1)
CAN2015_PSMODEL<-cbind(V1,CAN2015_PSMODEL)
V1<-matrix(1,nrow(USA2015_PSMODEL),1)
USA2015_PSMODEL<-cbind(V1,USA2015_PSMODEL)
colnames(CAN2015_PSMODEL)=c("V1","GENDER","ST011Q06","ST011Q07","ST013Q01","ST034Q01","MISCED",
"HISCED","MMINS","BELONG","HOMEPOS","ESCS","SC048Q01","SC048Q02","SC048Q03","SC061Q07","CLSIZE","treat","Y","CNTSTUID","SCHID")
colnames(USA2015_PSMODEL)=c("V1","GENDER","ST011Q06","ST011Q07","ST013Q01","ST034Q01","MISCED",
"HISCED","MMINS","BELONG","HOMEPOS","ESCS","SC048Q01","SC048Q02","SC048Q03","SC061Q07","CLSIZE","treat","Y","CNTSTUID","SCHID")
write.table(CAN2015_PSMODEL, file="CAN2015_PSMODEL.csv", col.names=T, row.names=F, sep=",", append=F)
write.table(USA2015_PSMODEL, file="USA2015_PSMODEL.csv", col.names=T, row.names=F, sep=",", append=F)
###########################################################################################################33
##PREPARING FULL MODEL###################################
USACAN<-read.csv("USACAN_FullModel.csv",header=T, sep=",")
USACAN$ST011Q06TA[USACAN$ST011Q06TA>=3]=NA
USACAN$ST011Q07TA[USACAN$ST011Q07TA>=3]=NA
USACAN$ST013Q01TA[USACAN$ST013Q01TA>=7]=NA
USACAN$HISCED[USACAN$HISCED>=7]=NA
USACAN$MISCED[USACAN$MISCED>=7]=NA
USACAN$HOMEPOS[USACAN$HOMEPOS<=-10|USACAN$HOMEPOS>=7]=NA
USACAN$SC048Q01NA[USACAN$SC048Q01NA>=101]=NA
USACAN$SC048Q02NA[USACAN$SC048Q02NA>=101]=NA
USACAN$SC048Q03NA[USACAN$SC048Q03NA>=101]=NA
USACAN$CLSIZE[USACAN$CLSIZE>=85]=NA
USACAN$SC014Q01NA[USACAN$SC014Q01NA>3]=NA
USACAN$SC013Q01TA[USACAN$SC014Q01TA>2]=NA
USACAN$BELONG[USACAN$BELONG <= -4 | USACAN$BELONG >= 3 ]=NA
USACAN$ESCS[USACAN$ESCS <= -8 | USACAN$ESCS >= 5 ]=NA
USACAN$MMINS[USACAN$MMINS>= 3000]=NA
USACAN$SC061Q07TA[USACAN$SC061Q07TA > 4]=NA
colnames(USACAN)[1]="CNTRYID"
CAN2015_FULLMODEL<-subset(USACAN,USACAN$CNTRYID=="124")
USA2015_FULLMODEL<-subset(USACAN, USACAN$CNTRYID=="840")

CAN2015_FULLMODEL$treat<-ifelse(CAN2015_FULLMODEL$SC013Q01TA=="2",1,0)
USA2015_FULLMODEL$treat<-ifelse(USA2015_FULLMODEL$SC013Q01TA=="2",1,0)
CAN2015_FULLMODEL<-CAN2015_FULLMODEL[complete.cases(CAN2015_FULLMODEL[ , 107]),]
USA2015_FULLMODEL<-USA2015_FULLMODEL[complete.cases(USA2015_FULLMODEL[ , 107]),]
CAN2015_FULLMODEL$Y<-CAN2015_FULLMODEL$PV1MATH
USA2015_FULLMODEL$Y<-USA2015_FULLMODEL$PV1MATH
CAN2015_FULLMODEL<-CAN2015_FULLMODEL[,c(5:106,108:115,3,4)]
USA2015_FULLMODEL<-USA2015_FULLMODEL[,c(5:106,108:115,3,4)]
CAN2015_FULLMODEL$SCHID<-CAN2015_FULLMODEL$CNTSCHID
USA2015_FULLMODEL$SCHID<-USA2015_FULLMODEL$CNTSCHID
CAN2015_FULLMODEL<-CAN2015_FULLMODEL[,-111]
USA2015_FULLMODEL<-USA2015_FULLMODEL[,-111]
indxNumCAN<-dim(CAN2015_FULLMODEL)[2]
indxNum2CAN<-indxNumCAN-3
varNamesCAN<-colnames(CAN2015_FULLMODEL[,c(1:indxNum2CAN)])
indxNumUSA<-dim(USA2015_FULLMODEL)[2]
indxNum2USA<-indxNumUSA-3
varNamesUSA<-colnames(USA2015_FULLMODEL[,c(1:indxNum2USA)])
V1<-matrix(1,nrow(CAN2015_FULLMODEL),1)
CAN2015_FULLMODEL<-cbind(V1,CAN2015_FULLMODEL)
V1<-matrix(1,nrow(USA2015_FULLMODEL),1)
USA2015_FULLMODEL<-cbind(V1,USA2015_FULLMODEL)
colnames(CAN2015_FULLMODEL)[c(1:6)]=c("V1","GENDER","ST011Q06","ST011Q07","ST013Q01","ST034Q01")
colnames(USA2015_FULLMODEL)[c(1:6)]=c("V1","GENDER","ST011Q06","ST011Q07","ST013Q01","ST034Q01")
colnames(CAN2015_FULLMODEL)[c(104:108)]=c("SC014Q01","SC048Q01","SC048Q02","SC048Q03","SC061Q07")
colnames(USA2015_FULLMODEL)[c(104:108)]=c("SC014Q01","SC048Q01","SC048Q02","SC048Q03","SC061Q07")
write.table(CAN2015_FULLMODEL, file="CAN2015_FULLMODEL.csv", col.names=T, row.names=F, sep=",", append=F)
write.table(USA2015_FULLMODEL, file="USA2015_FULLMODEL.csv", col.names=T, row.names=F, sep=",", append=F)

#m.out<-matchit(PSformulaUnWt, data=CAN2015_PSMODEL, method="nearest", distance="logit")
#vec_One<-as.vector(row.names(m.out$match.matrix))
#vec_One<-as.numeric(vec_One)
#vec_Two<-as.vector(m.out$match.matrix[,1])
#vec_Two<-as.numeric
#vec_comb<-c(vec_One, vec_Two)
#